{"version":3,"sources":["launch.js"],"names":["cc","Class","extends","Component","properties","display","Node","recordTemp","Prefab","data","records","showState","currentPage","start","wx","onMessage","message","getFriendCloudStorage","keyList","success","_show","res","maxPage","parseInt","length","clearInfo","rankRecords","loadInfo","_hide","console","log","getUserCloudStorage","KVDataList","score","value","kvdataList","push","key","setUserCloudStorage","i","newRecord","instantiate","loader","load","avatarUrl","err","tex","getChildByName","getComponent","Sprite","spriteFrame","SpriteFrame","Label","string","nickname","addChild","children","destroy","sortby","a","b","sort","moveTo","runAction"],"mappings":"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","file":"launch.js","sourceRoot":"..\\..\\..\\assets","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        display: cc.Node,\n        recordTemp: cc.Prefab,\n        data: [],\n        records: [],\n        showState:0,         //0代表分数score 1代表通过关卡数量 2代表...\n        currentPage:0\n    },\n\n    start() {\n        wx.onMessage(data => {\n            switch (data.message) {\n                case 'Show':\n                    wx.getFriendCloudStorage({\n                        keyList: ['score'],\n                        success: res => {\n                            this._show();\n                            this.data = res.data\n                            this.maxPage = parseInt((this.data.length - 1) / 6)\n                            this.clearInfo()\n                            this.rankRecords()\n                            this.loadInfo()\n                        }\n                    })\n                    break;\n                case 'Hide':\n                    this._hide();\n                    this.clearInfo()\n                    break;\n                case 'Left':\n                    if(this.currentPage===0) {\n                        console.log('This is the first page!')                     \n                        return\n                    }\n                    else{\n                        this.clearInfo()\n                        this.currentPage -= 1\n                        this.loadInfo()\n                    }\n                    break\n                case 'Right':\n                    if(this.currentPage===this.maxPage){\n                        console.log('No more pages!')\n                        return\n                    }\n                    else{\n                        this.clearInfo()\n                        this.currentPage += 1\n                        this.loadInfo()\n                    }\n                    break\n                case 'UpdateScore':\n                    wx.getUserCloudStorage({\n                        keyList:['score'],\n                        success:res=>{\n                            if(res.KVDataList.length === 0||parseInt(data.score)>parseInt(res.KVDataList[0].value)){\n                                let kvdataList = []\n                                kvdataList.push({\n                                    key:'score',\n                                    value:data.score\n                                })\n                                wx.setUserCloudStorage({\n                                    KVDataList:kvdataList\n                                })\n                            }\n                        }\n                    })\n            }\n        });\n    },\n\n    loadInfo: function () {\n        if (this.data.length === 0) return\n        //没有好友玩过这个游戏\n\n        for (let i = this.currentPage*6; i < this.currentPage*6+6 && i<this.data.length; ++i) {\n            if (this.data[i].KVDataList.length === 0) continue\n\n            let newRecord = cc.instantiate(this.recordTemp)\n            cc.loader.load(this.data[i].avatarUrl + '?aaa=aa.jpg', (err, tex) => {\n                newRecord.getChildByName('friend').getChildByName('avatar').getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(tex)\n            })\n            newRecord.getChildByName('ranking').getComponent(cc.Label).string = `${i+1}`\n            newRecord.getChildByName('friend').getChildByName('nickname').getComponent(cc.Label).string = this.data[i].nickname\n            newRecord.getChildByName('score').getComponent(cc.Label).string = this.data[i].KVDataList[0].value\n\n            this.display.getChildByName('View').getChildByName('Content').addChild(newRecord)\n        }\n    },\n\n    clearInfo: function () {\n        this.records = this.display.getChildByName('View').getChildByName('Content').children\n        if (this.records.length <= 2) return    //没有排名\n\n        for (let i = 2; i < this.records.length; ++i) {\n            this.records[i].destroy()\n        }\n    },\n\n    rankRecords: function () {\n        const sortby = function (a, b) {\n            if (b.KVDataList.length === 0)\n                return -1\n            if (a.KVDataList.length === 0)\n                return 1\n\n            return parseInt(a.KVDataList[0].value) >= parseInt(b.KVDataList[0].value) ? -1 : 1\n        }\n        this.data.sort(sortby)\n    },\n\n    _show() {\n        let moveTo = cc.moveTo(0.5,0,0)\n        this.display.runAction(moveTo)\n    },\n\n    _hide() {\n        let moveTo = cc.moveTo(0.5,0,1500)\n        this.display.runAction(moveTo)\n    }\n});\n"]}